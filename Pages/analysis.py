## -*- coding: utf-8 -*-
"""analysis

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1FWRQbp8jWBVK_ezjF7g9EDJpwimgadGa
"""

import streamlit as st
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import plotly.express as px
import seaborn as sns
import globals
import graficos
import plotly.graph_objects as go
from plotly.subplots import make_subplots

# Carregar os dados
df = pd.read_excel('https://github.com/MichaelJourdain93/Datathon_Passos_Magicos/raw/main/Datasets/dt_curated_passos_magicos.xlsx', engine='openpyxl')

# T√≠tulo da P√°gina
st.title("üìä An√°lise dos Dados da ONG Passos M√°gicos")

# Mostrar os primeiros dados
st.subheader("Visualiza√ß√£o dos Dados")

tab1, tab2 , tab3  = st.tabs(['Indicadores', 'An√°lises', 'Observa√ß√µes'])

with tab1:
    cbAno = st.selectbox('Selecione o Ano:', list(globals.lAno.keys()), key="cbAno")
    df_ano = globals.df
    if cbAno != 'Todos':
        df_ano = globals.df[globals.df['Ano Letivo'] == globals.lAno[cbAno]]
        if globals.lAno[cbAno] > 2022:
            df_ano_anterior = globals.df[globals.df['Ano Letivo'] == globals.lAno[cbAno] - 1]

    num_colunas_pedras = len(globals.lPedras)
    colunas_2 = st.columns(num_colunas_pedras)
    for i, dados in enumerate(globals.lPedras):
        coluna_atual = colunas_2[i % num_colunas_pedras]
        with coluna_atual:
            if cbAno != 'Todos' and globals.lAno[cbAno] > 2022:
                st.metric(dados, np.sum(df_ano['Pedra'] == dados), delta=int(np.sum(df_ano['Pedra'] == dados) - np.sum(df_ano_anterior['Pedra'] == dados)))
            else:
                st.metric(dados, np.sum(df_ano['Pedra'] == dados), delta=None)
    num_colunas = len(globals.lIndicadores_1)
    colunas_1 = st.columns(num_colunas, border=True)

    for i, dados in enumerate(globals.lIndicadores_1):
        coluna_atual = colunas_1[i % num_colunas]
        with coluna_atual:
            st.subheader(dados, help='Comparativo em rela√ß√£o ao ano anterior')
            if(cbAno != 'Todos' and globals.lAno[cbAno] > 2022):
                st.metric('M√©dia:', df_ano[dados].mean().round(2), border=False, delta=round(df_ano[dados].mean().round(2) - df_ano_anterior[dados].mean().round(2),2))
                st.metric('Mediana:', df_ano[dados].median().round(2), border=False, delta=round(df_ano[dados].median().round(2) - df_ano_anterior[dados].median().round(2),2))
                st.metric('Min:', df_ano[dados].min().round(2), border=False, delta=round(df_ano[dados].min().round(2) - df_ano_anterior[dados].min().round(2),2))
                st.metric('Max:', df_ano[dados].max().round(2), border=False, delta=round(df_ano[dados].max().round(2) - df_ano_anterior[dados].max().round(2), 2))
            else:
                st.metric('M√©dia:', df_ano[dados].mean().round(2),border=False, delta=None, delta_color='off')
                st.metric('Mediana:', df_ano[dados].median().round(2),border=False, delta=None, delta_color='off')
                st.metric('Min:', df_ano[dados].min().round(2),border=False, delta=None, delta_color='off')
                st.metric('Max:', df_ano[dados].max().round(2),border=False, delta=None, delta_color='off')

# An√°lise descritiva b√°sica
with tab2:
        st.header("An√°lise Descritiva")
        
        # Distribui√ß√£o dos Alunos por G√™nero
        st.subheader("Distribui√ß√£o dos Alunos por G√™nero")
        # Criar DataFrame com alunos √∫nicos (sem duplicatas de nome)
        df_unique = df.drop_duplicates(subset='Nome')

        # Plotar o gr√°fico com base nos alunos √∫nicos
        fig, ax = plt.subplots(figsize=(12, 4))
        df_unique['G√™nero'].value_counts().plot(kind='bar', ax=ax, color=['skyblue', 'lightcoral'])
        ax.set_xlabel('G√™nero')
        ax.set_ylabel('N√∫mero de Alunos (√önicos)')  # Legenda atualizada para refletir a mudan√ßa
        ax.set_xticklabels(ax.get_xticklabels(), rotation=0)
        st.pyplot(fig)

    
        st.write("""
        O n√∫mero de alunos do g√™nero **feminino** √© ligeiramente maior do que o do g√™nero **masculino**,
        com ambos os grupos apresentando valores pr√≥ximos de **1500 alunos**. Essa distribui√ß√£o sugere uma
        relativa paridade entre os g√™neros, indicando que n√£o h√° uma diferen√ßa significativa na quantidade
        de alunos entre homens e mulheres.
        """)
    
        # Distribui√ß√£o de Alunos por Fase Educacional
        st.subheader("Distribui√ß√£o de Alunos por Fase Educacional")
        fig, ax = plt.subplots(figsize=(12, 6))
        df['Fase'].value_counts().sort_index().plot(kind='bar', ax=ax, color='lightgreen')
        ax.set_xlabel('Fase')
        ax.set_ylabel('N√∫mero de Alunos')
        ax.set_xticklabels(ax.get_xticklabels(), rotation=0)
        st.pyplot(fig)
    
        st.write("""
        A maior parte dos alunos est√° nas fases iniciais (0 a 3), representando cerca de 55% do total.
        A fase 0 sozinha corresponde a aproximadamente 22%. Conforme a progress√£o, h√° uma queda no n√∫mero de alunos:
        as fases intermedi√°rias (4 a 6) concentram 16%, e as finais (7 a 9) apenas 7%. Isso indica uma poss√≠vel dificuldade
        na reten√ß√£o e progress√£o dos estudantes. A ONG 'Passos M√°gicos' pode direcionar estrat√©gias para incentivar a continuidade
        dos estudos e minimizar a evas√£o nas fases mais avan√ßadas.
        """)
    
        # Distribui√ß√£o de Alunos por Idade
        st.subheader("Distribui√ß√£o de Alunos por Idade")
        fig, ax = plt.subplots(figsize=(10, 6))
        df['Idade'].value_counts().sort_index().plot(kind='bar', color='skyblue', ax=ax)
        ax.set_xlabel('Idade')
        ax.set_ylabel('N√∫mero de Alunos')
        ax.set_xticks(range(len(df['Idade'].unique())))
        ax.set_xticklabels(df['Idade'].value_counts().sort_index().index, rotation=45)
        st.pyplot(fig)
    
        st.write("""
        - A maior concentra√ß√£o de alunos est√° na faixa et√°ria de **12 anos**, seguida por **11 e 13 anos**.
        - O n√∫mero de alunos diminui drasticamente a partir dos **16 anos**, indicando maior evas√£o ou menor reten√ß√£o em idades mais avan√ßadas.
        - Esses dados refor√ßam a import√¢ncia de interven√ß√µes direcionadas para alunos mais velhos, que apresentam maior defasagem e menor presen√ßa no programa.
        """)
    
        # Rela√ß√£o entre Idade e INDE por Fase
        st.subheader("Rela√ß√£o entre Idade e INDE por Fase")
        fig, ax = plt.subplots(figsize=(12, 6))
        sns.scatterplot(x='Idade', y='INDE', hue='Fase', data=df, palette='tab10', ax=ax)
        ax.set_xlabel('Idade')
        ax.set_ylabel('INDE')
        ax.legend(title='Fase', bbox_to_anchor=(1.05, 1), loc='upper left')
        st.pyplot(fig)
    
        st.write("""
        As fases iniciais concentram alunos mais jovens, enquanto as fases intermedi√°rias e avan√ßadas apresentam maior diversidade de faixas et√°rias.
        Isso reflete o esfor√ßo da ONG em atender alunos com diferentes n√≠veis de aprendizado, mas tamb√©m destaca a necessidade de suporte para alunos fora da faixa et√°ria padr√£o.
        """)
    
        # Rela√ß√£o entre Idade e INDE por G√™nero
        st.subheader("Rela√ß√£o entre Idade e INDE por G√™nero")
        fig = px.scatter(df, x='Idade', y='INDE', color='G√™nero')
        st.plotly_chart(fig)
    
        st.write("""
        **Rela√ß√£o entre Idade e INDE**: Observa-se que o **INDE** varia pouco com a idade, mas alunos mais jovens (at√© **15 anos**) apresentam maior concentra√ß√£o de valores altos.
        Al√©m disso, n√£o h√° diferen√ßas significativas entre os g√™neros em termos de desenvolvimento educacional, embora as meninas apresentem, em geral, um desempenho ligeiramente melhor.
        """)
    
        # Defasagem por Idade
        st.subheader("Defasagem por Idade")
        fig, ax = plt.subplots(figsize=(12, 6))
        sns.barplot(x='Idade', y='Defasagem', data=df, ci=None, palette='viridis', ax=ax)
        ax.set_xlabel('Idade')
        ax.set_ylabel('Defasagem (anos)')
        ax.set_xticklabels(df['Idade'], rotation=45)
        st.pyplot(fig)
    
        st.write("""
        1. **Defasagem Negativa em Idades Mais Jovens**: Alunos com idades entre **10 e 15 anos** apresentam, em m√©dia, defasagem negativa (valores abaixo de 0), indicando que est√£o adiantados em rela√ß√£o √† fase ideal para sua idade.
        2. **Defasagem Positiva em Idades Mais Avan√ßadas**: A partir dos **18 anos**, a defasagem m√©dia come√ßa a aumentar significativamente, atingindo valores positivos altos (acima de 0). Isso sugere que alunos mais velhos est√£o atrasados em rela√ß√£o √† fase educacional esperada.
        3. **Transi√ß√£o Cr√≠tica**: Entre as idades de **16 e 17 anos**, a defasagem se aproxima de zero, marcando uma transi√ß√£o entre alunos adiantados e atrasados. Esse padr√£o reflete desafios espec√≠ficos enfrentados por alunos mais velhos e destaca a necessidade de interven√ß√µes direcionadas para reduzir a defasagem nas idades mais avan√ßadas.
        """)
    
        # Rela√ß√£o entre Defasagem e INDE por Fase
        st.subheader("Rela√ß√£o entre Defasagem e INDE por Fase")
        fig, ax = plt.subplots(figsize=(12, 6))
        sns.scatterplot(x='Defasagem', y='INDE', hue='Fase', data=df, palette='tab10', ax=ax)
        ax.set_xlabel('Defasagem (anos)')
        ax.set_ylabel('INDE')
        ax.legend(title='Fase', bbox_to_anchor=(1.05, 1), loc='upper left')
        st.pyplot(fig)
    
        st.write("""
        Alunos com maior defasagem (idade superior √† fase ideal) apresentam valores mais baixos de **INDE**, indicando que a defasagem impacta negativamente o desenvolvimento educacional.
        No entanto, alunos com defasagem pr√≥xima de **zero** tendem a ter melhores indicadores.
        """)
    
        # Rela√ß√£o entre INDE e IDA
        st.subheader("Rela√ß√£o entre INDE e IDA")
        fig = px.scatter(df, x='INDE', y='IDA', color='Pedra', hover_data=['Nome', 'Fase', 'Idade'])
        st.plotly_chart(fig)
    
        st.write("""
        A rela√ß√£o entre **INDE** (Indicador de Desenvolvimento Educacional) e **IDA** (Indicador de Desempenho Acad√™mico) apresenta uma correla√ß√£o positiva clara.
        √Ä medida que o **INDE** aumenta, o **IDA** tamb√©m tende a crescer, indicando que um maior desenvolvimento educacional est√° associado a melhores desempenhos acad√™micos.
        A dispers√£o dos pontos sugere varia√ß√µes individuais, mas a tend√™ncia geral √© consistente.
        """)
    
        # Distribui√ß√£o das Notas por Disciplina
        st.subheader("Distribui√ß√£o das Notas por Disciplina")
        fig, ax = plt.subplots(figsize=(12, 6))
        df[['Mat', 'Por', 'Ing']].boxplot(ax=ax)
        ax.set_ylabel('Notas')
        st.pyplot(fig)
    
        st.write("""
        As medianas das tr√™s disciplinas s√£o semelhantes (em torno de **6 a 7**), com **Ingl√™s** apresentando uma distribui√ß√£o ligeiramente mais alta.
        No entanto, todas as disciplinas t√™m **outliers significativos** em notas muito baixas, indicando que alguns alunos enfrentam dificuldades espec√≠ficas.
        A amplitude das notas √© maior em **Matem√°tica** e **Portugu√™s** do que em Ingl√™s.
        """)
    
        # Mapa de Correla√ß√£o entre Indicadores e Notas
        st.subheader("Mapa de Correla√ß√£o entre Indicadores e Notas")
        fig, ax = plt.subplots(figsize=(12, 10))
        sns.heatmap(df[['INDE', 'IAA', 'IEG', 'IPS', 'IDA', 'IPV', 'IAN', 'IPP', 'Mat', 'Por', 'Ing']].corr(), annot=True, cmap='coolwarm', ax=ax)
        ax.set_title('Mapa de Correla√ß√£o')
        st.pyplot(fig)
    
        st.write("""
        O heatmap de correla√ß√£o revela as rela√ß√µes entre diferentes indicadores e notas dos estudantes atendidos pela ONG "Passos M√°gicos". As correla√ß√µes variam de -1 (menor correla√ß√£o) a 1 (maior correla√ß√£o).
        Entre os destaques, o **IDA** (Indicador de Desempenho Acad√™mico) apresenta forte correla√ß√£o com as notas em Matem√°tica (0.85), Portugu√™s (0.82) e Ingl√™s (0.90), confirmando que o desempenho acad√™mico
        √© influenciado diretamente pelas disciplinas. Al√©m disso, o **INDE** (Indicador de Desenvolvimento Educacional) tem alta correla√ß√£o com o **IEG** (Indicador de Engajamento), sugerindo que maior engajamento
        est√° associado a melhores resultados educacionais.
    
        Outros insights incluem a moderada influ√™ncia do **IPS** (Indicador Psicossocial) no desenvolvimento educacional e nos pontos de virada, e a baixa correla√ß√£o do **IAN** (Indicador de Adequa√ß√£o de N√≠vel) com
        outros indicadores. As notas das tr√™s disciplinas possuem alta correla√ß√£o entre si, indicando que bons desempenhos tendem a ser consistentes em todas as √°reas. Estrat√©gias pr√°ticas devem focar no aumento do
        engajamento (**IEG**), que est√° fortemente relacionado ao desenvolvimento educacional (**INDE**) e ao desempenho acad√™mico (**IDA**).
        """)
    
        # Rela√ß√£o entre INDE e IDA por Tipo de Pedra
        st.subheader("Rela√ß√£o entre INDE e IDA por Tipo de Pedra")
        fig = px.scatter(df, x='INDE', y='IDA', color='Pedra', hover_data=['Nome', 'Fase', 'Idade'])
        fig.update_layout(title='Rela√ß√£o entre INDE e IDA por Tipo de Pedra')
        st.plotly_chart(fig)
    
        st.write("""
        A rela√ß√£o entre INDE e IDA √© consistente entre os diferentes tipos de pedra (Quartzo, Ametista, √Ågata, Top√°zio), mas as categorias com maior densidade nas faixas
        superiores de INDE e IDA (como Ametista e Top√°zio) sugerem que esses grupos apresentam melhores desempenhos gerais.
        """)
    
        # Distribui√ß√£o de Pedras por Fase
        st.subheader("Distribui√ß√£o de Pedras por Fase")
        pedra_fase = pd.crosstab(df['Fase'], df['Pedra'])
        fig = go.Figure(data=[
            go.Bar(name=pedra, x=pedra_fase.index, y=pedra_fase[pedra]) for pedra in pedra_fase.columns
        ])
        fig.update_layout(barmode='stack')
        st.plotly_chart(fig)
    
        st.write("""
        1. **Distribui√ß√£o por Fase**:
        A maioria dos alunos est√° concentrada nas fases iniciais (0, 1, 2 e 3), com uma redu√ß√£o progressiva nas fases mais avan√ßadas. Isso indica que o programa da ONG tem
        maior impacto nas etapas iniciais de forma√ß√£o.
    
        2. **Distribui√ß√£o por Pedra**:
        As categorias de pedra (Top√°zio, Quartzo, Ametista e √Ågata) est√£o bem representadas em todas as fases iniciais, mas a presen√ßa diminui significativamente nas fases
        finais. Top√°zio e Quartzo dominam as fases intermedi√°rias, enquanto √Ågata tem maior destaque nas fases finais (como a fase 8). Isso pode refletir diferentes n√≠veis de
        desempenho ou engajamento ao longo do tempo.
        """)
    
        # Compara√ß√£o dos Indicadores M√©dios por Pedra
        st.subheader("Compara√ß√£o dos Indicadores M√©dios por Pedra")
        indicadores = ['INDE', 'IAA', 'IEG', 'IPS', 'IDA', 'IPV', 'IAN', 'IPP']
        medias_por_pedra = df.groupby('Pedra')[indicadores].mean()
        fig = go.Figure()
        for pedra in medias_por_pedra.index:
            fig.add_trace(go.Scatterpolar(
                r=medias_por_pedra.loc[pedra],
                theta=indicadores,
                fill='toself',
                name=pedra
            ))
        fig.update_layout(
            polar=dict(radialaxis=dict(visible=True, range=[0, 10])),
            showlegend=True,
        )
        st.plotly_chart(fig)
    
        st.write("""
        As categorias de pedra apresentam desempenhos m√©dios semelhantes em todos os indicadores, com destaque para **IEG** (Indicador de Engajamento) e **INDE** (Indicador de Desenvolvimento Educacional),
        que possuem valores mais elevados. Isso sugere que o engajamento est√° fortemente alinhado ao desenvolvimento educacional.
        """)
    
        # Evolu√ß√£o do INDE ao Longo dos Anos
        st.subheader("Evolu√ß√£o do INDE ao Longo dos Anos")
        df['Ano Letivo'] = pd.to_datetime(df['Ano Letivo'], format='%Y')
        inde_por_ano = df.groupby('Ano Letivo')['INDE'].mean().reset_index()
        fig = px.line(inde_por_ano, x='Ano Letivo', y='INDE')
        st.plotly_chart(fig)
    
        st.write("""
        O INDE apresenta um crescimento constante at√© o in√≠cio de 2023, seguido por uma queda gradual. Isso indica que houve avan√ßos significativos no desenvolvimento educacional no per√≠odo inicial,
        mas desafios surgiram posteriormente, possivelmente relacionados a mudan√ßas no programa ou fatores externos.
        """)
    
        # An√°lises de Indicadores Acad√™micos e Engajamento por Institui√ß√£o de Ensino
        st.subheader("An√°lises de Indicadores Acad√™micos e Engajamento por Institui√ß√£o de Ensino")
        fig1 = px.box(df, x='Institui√ß√£o de ensino', y='IDA')
        st.plotly_chart(fig1)
    
        st.write("""
        Alunos de institui√ß√µes privadas com programas de bolsas apresentam **IDA mais alto** em compara√ß√£o com escolas p√∫blicas ou redes convencionais.
        Isso evidencia o impacto positivo de iniciativas direcionadas, como bolsas e programas de apadrinhamento, no desempenho acad√™mico.
        """)
    
        # Rela√ß√£o entre Engajamento (IEG) e Ponto de Virada (IPV)
        st.subheader("Rela√ß√£o entre Engajamento (IEG) e Ponto de Virada (IPV)")
        fig2 = px.scatter(df, x='IEG', y='IPV', color='Pedra', hover_data=['Nome', 'Fase'])
        st.plotly_chart(fig2)
    
        st.write("""
        H√° uma **correla√ß√£o positiva** entre o IEG (Indicador de Engajamento) e o IPV (Indicador de Ponto de Virada).
        √Ä medida que o engajamento aumenta, os pontos de virada tamb√©m tendem a crescer, indicando que maior engajamento est√° associado a momentos significativos de progresso no desenvolvimento dos alunos.
    
        - **Distribui√ß√£o por Pedras**: Ametista e Top√°zio predominam nos n√≠veis mais altos de engajamento (**IEG > 8**) e ponto de virada (**IPV > 8**), sugerindo maior desempenho. J√° Quartzo e √Ågata est√£o mais concentrados em n√≠veis m√©dios, indicando √°reas para melhoria.
        - **Concentra√ß√£o de Dados**: A maioria dos alunos apresenta valores intermedi√°rios de IEG (**entre 5 e 8**) e IPV (**entre 4 e 8**), refletindo um bom n√≠vel geral de engajamento e impacto, mas com espa√ßo para impulsionar os extremos superiores.
        """)
        
# Storytelling
with tab3:
    st.subheader("Impacto da ONG Passos M√°gicos")
    st.write("A an√°lise dos dados da ONG Passos M√°gicos revela insights importantes sobre o impacto do programa:")
    st.write("**1. Diversidade de Atendimento:**")
    st.write(f"- A ONG atende {df['G√™nero'].nunique()} g√™neros diferentes.")
    st.write(f"- Os alunos est√£o distribu√≠dos em {df['Fase'].nunique()} fases diferentes, mostrando a amplitude do programa.")
    st.write(" - Os alunos da fase 9 podem ser facilmente assimilados aos da fase 8, segundo o comportamento do seus dados ")

    st.write("**2. Desempenho Acad√™mico:**")
    st.write(f"- A m√©dia do IDA (Indicador de Desempenho Acad√™mico) √© {df['IDA'].mean():.2f}.")
    st.write(f"- Correla√ß√£o positiva de {df['INDE'].corr(df['IDA']):.2f} entre INDE e IDA.")

    st.write("**3. Engajamento e Desenvolvimento:**")
    st.write(f"- IEG m√©dio: {df['IEG'].mean():.2f}, indicando bom n√≠vel de participa√ß√£o.")
    st.write(f"- IPV m√©dio: {df['IPV'].mean():.2f}, mostrando progresso significativo.")

    st.write("**4. Impacto por Tipo de Institui√ß√£o:**")
    instituicoes = df.groupby('Institui√ß√£o de ensino')['IDA'].mean().sort_values(ascending=False)
    st.write(f"- Maior IDA m√©dio: '{instituicoes.index[0]}' com {instituicoes.iloc[0]:.2f}.")
    st.write(f"- Menor IDA m√©dio: '{instituicoes.index[-1]}' com {instituicoes.iloc[-1]:.2f}.")

    st.write("**5. Evolu√ß√£o ao Longo do Tempo:**")
    inde_inicial = inde_por_ano['INDE'].iloc[0]
    inde_final = inde_por_ano['INDE'].iloc[-1]
    variacao_inde = (inde_final - inde_inicial) / inde_inicial * 100
    st.write(f"- O INDE m√©dio variou de {inde_inicial:.2f} para {inde_final:.2f}, uma mudan√ßa de {variacao_inde:.2f}%.")

    st.write("**Conclus√£o:**")
    st.write("A an√°lise demonstra que a ONG Passos M√°gicos tem um impacto positivo significativo na vida dos estudantes atendidos. O programa melhora o desempenho acad√™mico e promove o engajamento e desenvolvimento pessoal.")
